<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Gemini CLI 凭证获取教程 - 为星星人民公益站捐赠API Key">
    <meta name="keywords" content="Gemini CLI,API Key获取,公益捐赠,星星人民公益站">
    <meta name="author" content="星星人民公益站">
    
    <!-- 安全相关meta标签 -->
    <meta name="robots" content="index, follow">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://cdn.jsdelivr.net; img-src 'self' data: https:; font-src 'self' https://cdn.jsdelivr.net;">
    <meta name="theme-color" content="#e63946">
    
    <title>Gemini CLI 凭证获取捐赠教程 - 星星人民公益站</title>
    
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#e63946',
                        secondary: '#e63946',
                    }
                }
            }
        }
    </script>
    
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <style>
        .code-block {
            background: #1a202c;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            overflow-x: auto;
            position: relative;
            -webkit-overflow-scrolling: touch; /* 移动端平滑滚动 */
        }
        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #e2e8f0;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            z-index: 9999; /* 提高z-index确保在最上层 */
            transition: all 0.2s ease;
            white-space: nowrap; /* 防止按钮文字换行 */
        }
        .copy-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-1px);
        }
        
        .code-block pre {
            padding-right: 4rem; /* 为复制按钮留出空间 */
            margin: 0;
            overflow-x: auto;
            word-wrap: break-word; /* 允许长单词换行 */
            white-space: pre-wrap; /* 保留空格但允许换行 */
            word-break: break-all; /* 强制长单词换行 */
        }
        .step-number {
            background: #e63946;
            color: white;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 1rem;
            flex-shrink: 0;
        }

        /* 移动端适配 */
        @media (max-width: 640px) {
            .step-number {
                width: 1.75rem;
                height: 1.75rem;
                margin-right: 0.75rem;
                font-size: 0.9rem;
            }
            
            .code-block {
                padding: 0.75rem;
                margin: 0.5rem 0;
                font-size: 0.8rem;
            }
            
            .code-block pre {
                padding-right: 3.5rem;
                font-size: 0.8rem;
                line-height: 1.4;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .copy-btn {
                padding: 0.3rem 0.7rem;
                font-size: 0.7rem;
                top: 0.3rem;
                right: 0.3rem;
                min-width: 45px; /* 确保按钮有足够宽度 */
            }
            
            main {
                padding: 1rem;
            }
            
            h1 {
                font-size: 1.75rem;
                line-height: 1.3;
            }
            
            h2 {
                font-size: 1.25rem;
                line-height: 1.3;
            }
            
            h3 {
                font-size: 1.1rem;
                line-height: 1.3;
            }
            
            /* 代码块中的长URL和命令适配 */
            .code-block pre code {
                display: block;
                overflow-x: auto;
                padding: 0.5rem 0;
            }
            
            /* 长命令自动换行 */
            .code-block pre {
                white-space: pre-wrap;
                word-wrap: break-word;
                word-break: break-word;
            }
            
            /* 注意事项移动端适配 */
            .bg-yellow-50, .bg-red-50 {
                padding: 1rem;
                margin: 1rem 0;
            }
            
            .bg-yellow-50 ul, .bg-red-50 ul {
                padding-left: 1rem;
            }
            
            .bg-yellow-50 li, .bg-red-50 li {
                margin-bottom: 0.5rem;
                font-size: 0.9rem;
            }
            
            .bg-yellow-50 code, .bg-red-50 code {
                word-break: break-all;
                font-size: 0.75rem;
                padding: 0.2rem 0.3rem;
            }
            
            /* 步骤容器移动端适配 */
            .flex.items-start {
                flex-direction: column;
                margin-bottom: 1.5rem;
            }
            
            .step-number {
                margin-bottom: 0.5rem;
                margin-right: 0;
            }
            
            /* 详细教程部分移动端优化 */
            .space-y-6 > div {
                margin-bottom: 1.5rem;
            }
            
            /* 故障排除部分移动端优化 */
            .bg-red-50 .bg-white {
                padding: 1rem;
                margin: 0.5rem 0;
            }
            
            /* 确保文本在移动端可读 */
            p, li {
                font-size: 0.9rem;
                line-height: 1.5;
            }
        }

        @media (max-width: 480px) {
            .step-number {
                width: 1.5rem;
                height: 1.5rem;
                margin-right: 0;
                font-size: 0.8rem;
                margin-bottom: 0.5rem;
            }
            
            .code-block {
                padding: 0.6rem;
                font-size: 0.75rem;
                margin: 0.4rem 0;
            }
            
            .code-block pre {
                padding-right: 2.8rem;
                font-size: 0.75rem;
                line-height: 1.3;
            }
            
            .copy-btn {
                padding: 0.2rem 0.5rem;
                font-size: 0.65rem;
                top: 0.2rem;
                right: 0.2rem;
                min-width: 40px;
            }
            
            /* 超小屏幕优化 */
            .bg-yellow-50, .bg-red-50 {
                padding: 0.75rem;
                margin: 0.8rem 0;
            }
            
            .bg-yellow-50 h2, .bg-red-50 h2 {
                font-size: 1.1rem;
            }
            
            .bg-yellow-50 li, .bg-red-50 li {
                font-size: 0.85rem;
                margin-bottom: 0.4rem;
            }
            
            .bg-yellow-50 code, .bg-red-50 code {
                font-size: 0.7rem;
                padding: 0.15rem 0.25rem;
            }
            
            /* 标题和文本进一步缩小 */
            h1 {
                font-size: 1.6rem;
            }
            
            h2 {
                font-size: 1.15rem;
            }
            
            h3 {
                font-size: 1rem;
            }
            
            p, li {
                font-size: 0.85rem;
            }
            
            /* 确保长URL和命令在超小屏幕上可读 */
            .code-block pre {
                white-space: pre-wrap;
                word-break: break-word;
            }
            
            /* 减少内边距 */
            main {
                padding: 0.8rem;
            }
            
            .bg-white.rounded-lg.shadow-md {
                padding: 1rem;
            }
            
            /* 步骤间距调整 */
            .space-y-4 > div, .space-y-6 > div {
                margin-bottom: 1.2rem;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 导航栏 -->
    <nav class="bg-white shadow-sm" style="margin-top: 60px;">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <a href="../index.html" class="flex items-center text-primary font-bold text-xl">
                    <i class="fa fa-star mr-2"></i>
                    星星人民公益站
                </a>
                <a href="../index.html" class="text-gray-600 hover:text-primary">
                    <i class="fa fa-home mr-1"></i>返回首页
                </a>
            </div>
        </div>
    </nav>

    <!-- 主内容 -->
    <main class="max-w-4xl mx-auto px-4 py-8">
        <!-- 标题 -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-4 mt-4">
                <i class="fa fa-graduation-cap text-primary mr-3"></i>
                Gemini CLI 凭证获取捐赠教程
            </h1>
        </div>

        <!-- 介绍 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="flex items-start mb-4">
                <i class="fa fa-info-circle text-primary text-2xl mr-3 mt-1"></i>
                <div>
                    <h2 class="text-xl font-bold text-gray-800 mb-2">教程说明</h2>
                    <p class="text-gray-600">
                        本教程将指导您如何通过 Gemini CLI 工具获取 API 凭证文件，用于捐赠给星星人民公益站。
                        您的捐赠将帮助更多人免费使用先进的 AI 技术！
                    </p>
                </div>
            </div>
        </div>

        <!-- 安装指南 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fa fa-download text-primary mr-3"></i>
                安装指南
            </h2>

            <!-- Termux -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                    <i class="fa fa-mobile text-primary mr-2"></i>
                    Termux 环境
                </h3>
                <p class="text-gray-600 mb-3 text-sm">
                    <strong>每次开启termux运行这个脚本即可，进程会自动后台运行</strong>
                </p>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
                    <pre>curl -o termux-install.sh "https://raw.githubusercontent.com/su-kaka/gcli2api/refs/heads/master/termux-install.sh" && chmod +x termux-install.sh && ./termux-install.sh</pre>
                </div>
            </div>

            <!-- Windows -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                    <i class="fa fa-windows text-primary mr-2"></i>
                    Windows 环境
                </h3>
                <p class="text-gray-600 mb-3 text-sm">
                    <strong>初始安装，选择一个你喜欢的文件夹，右键选择打开控制台</strong>
                </p>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
                    <pre>iex (iwr "https://raw.githubusercontent.com/su-kaka/gcli2api/refs/heads/master/install.ps1" -UseBasicParsing).Content</pre>
                </div>
                <p class="text-gray-600 mt-3 text-sm">
                    <strong>下一次需要启动：</strong>双击执行 <code class="bg-gray-100 px-2 py-1 rounded">start.bat</code>
                </p>
            </div>

            <!-- Linux -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                    <i class="fa fa-linux text-primary mr-2"></i>
                    Linux 环境
                </h3>
                <p class="text-gray-600 mb-3 text-sm">
                    <strong>初始安装</strong>
                </p>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
                    <pre>curl -o install.sh "https://raw.githubusercontent.com/su-kaka/gcli2api/refs/heads/master/install.sh" && chmod +x install.sh && ./install.sh</pre>
                </div>
                <p class="text-gray-600 mt-3 text-sm">
                    <strong>下一次需要启动：</strong>
                </p>
                <div class="code-block mt-2">
                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
                    <pre>cd gcli2api
bash start.sh</pre>
                </div>
            </div>
        </div>

        <!-- 配置说明 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fa fa-cog text-primary mr-3"></i>
                配置说明
            </h2>

            <div class="space-y-4">
                <div class="flex items-start">
                    <div class="step-number">1</div>
                    <div>
                        <h3 class="font-semibold text-gray-800">访问认证页面</h3>
                        <p class="text-gray-600">在浏览器中打开：</p>
                        <div class="code-block mt-2">
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                            <pre>http://127.0.0.1:7861/auth</pre>
                        </div>
                    </div>
                </div>

                <div class="flex items-start">
                    <div class="step-number">2</div>
                    <div>
                        <h3 class="font-semibold text-gray-800">完成 OAuth 认证</h3>
                        <p class="text-gray-600">使用默认密码：<code class="bg-gray-100 px-2 py-1 rounded">pwd</code></p>
                        <p class="text-gray-600 text-sm mt-2">按照页面指引完成 Google OAuth 认证流程</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 详细使用教程 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fa fa-book text-primary mr-3"></i>
                详细使用教程
            </h2>

            <div class="space-y-6">
                <div class="flex items-start">
                    <div class="step-number">1</div>
                    <div>
                        <h3 class="font-semibold text-gray-800">安装 Gemini CLI</h3>
                        <p class="text-gray-600 mb-3">使用 npm 全局安装官方 Gemini CLI 工具：</p>
                        <div class="code-block">
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                            <pre>npx https://github.com/google-gemini/gemini-cli</pre>
                        </div>
                    </div>
                </div>

                <div class="flex items-start">
                    <div class="step-number">2</div>
                    <div>
                        <h3 class="font-semibold text-gray-800">选择认证选项</h3>
                        <p class="text-gray-600 mb-3">运行命令后选择选项 1（用户认证）：</p>
                        <div class="code-block">
                            <button class="copy-btn" onclick="copyCode(this)">复制</button>
                            <pre>? 选择认证方式 › - 使用箭头键选择，按回车确认
❯ 用户认证 (User Authentication)
  服务账号认证 (Service Account Authentication)</pre>
                        </div>
                    </div>
                </div>

                <div class="flex items-start">
                    <div class="step-number">3</div>
                    <div>
                        <h3 class="font-semibold text-gray-800">完成浏览器认证</h3>
                        <p class="text-gray-600">按回车确认后，系统会自动打开浏览器完成 Google 账户认证：</p>
                        <ul class="text-gray-600 text-sm mt-2 space-y-1">
                            <li>• 在浏览器中选择要使用的 Google 账户</li>
                            <li>• 授予必要的 API 访问权限</li>
                            <li>• 认证完成后会自动返回命令行</li>
                        </ul>
                    </div>
                </div>

                <div class="flex items-start">
                    <div class="step-number">4</div>
                    <div>
                        <h3 class="font-semibold text-gray-800">获取凭证文件</h3>
                        <p class="text-gray-600">认证成功后，系统会自动生成 JSON 凭证文件：</p>
                        <ul class="text-gray-600 text-sm mt-2 space-y-1">
                            <li>• 文件位置：<code class="bg-gray-100 px-1 py-0.5 rounded">./geminicli/creds/</code> 目录</li>
                            <li>• 文件名格式：<code class="bg-gray-100 px-1 py-0.5 rounded">credentials_*.json</code></li>
                            <li>• 包含完整的 API 访问凭证信息</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- 故障排除 -->
        <div class="bg-red-50 border-l-4 border-red-400 p-6 mb-8 rounded-lg">
            <h2 class="text-2xl font-bold text-red-800 mb-6 flex items-center">
                <i class="fa fa-wrench text-red-600 mr-3"></i>
                故障排除 - 400 错误解决方案
            </h2>

            <div class="space-y-4">
                <div class="bg-white p-4 rounded-lg">
                    <h3 class="font-semibold text-red-700 mb-3">问题描述</h3>
                    <p class="text-red-600 mb-4">在使用过程中可能会遇到 400 Bad Request 错误，这通常是由于认证配置问题导致的。</p>
                    
                    <h3 class="font-semibold text-red-700 mb-3">解决方案</h3>
                    <div class="space-y-3">
                        <div class="flex items-start">
                            <div class="step-number bg-red-600">1</div>
                            <div>
                                <p class="text-gray-800 font-medium">重新运行认证流程</p>
                                <p class="text-gray-600 text-sm">确保按照上述详细教程的步骤重新进行认证</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start">
                            <div class="step-number bg-red-600">2</div>
                            <div>
                                <p class="text-gray-800 font-medium">检查网络连接</p>
                                <p class="text-gray-600 text-sm">确保网络连接稳定，能够正常访问 Google 服务</p>
                            </div>
                        </div>
                        
                        <div class="flex items-start">
                            <div class="step-number bg-red-600">3</div>
                            <div>
                                <p class="text-gray-800 font-medium">清除缓存文件</p>
                                <p class="text-gray-600 text-sm">删除旧的凭证文件后重新认证：</p>
                                <div class="code-block mt-2">
                                    <button class="copy-btn" onclick="copyCode(this)">复制</button>
                                    <pre>rm -rf ./geminicli/creds/*.json</pre>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex items-start">
                            <div class="step-number bg-red-600">4</div>
                            <div>
                                <p class="text-gray-800 font-medium">检查浏览器设置</p>
                                <p class="text-gray-600 text-sm">确保浏览器允许弹出窗口，没有拦截认证页面的打开</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 注意事项 -->
        <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 sm:p-6 mb-6 sm:mb-8 rounded-lg">
            <div class="flex flex-col sm:flex-row sm:items-start">
                <div class="flex justify-center sm:justify-start mb-3 sm:mb-0 sm:mr-3">
                    <i class="fa fa-exclamation-triangle text-yellow-600 text-2xl sm:mt-1"></i>
                </div>
                <div class="flex-1">
                    <h2 class="text-lg sm:text-xl font-bold text-yellow-800 mb-3 text-center sm:text-left">⚠️ 注意事项</h2>
                    <ul class="text-yellow-700 space-y-3">
                        <li class="flex flex-col sm:flex-row sm:items-start">
                            <div class="flex items-start mb-1 sm:mb-0 sm:mr-2">
                                <i class="fa fa-circle text-yellow-600 mr-2 mt-1 text-xs flex-shrink-0"></i>
                            </div>
                            <span class="text-sm sm:text-base">当前 OAuth 验证流程<strong>仅支持本地主机（localhost）访问</strong>，即必须通过 <code class="bg-yellow-100 px-1 py-0.5 rounded text-xs sm:text-sm">http://127.0.0.1:7861/auth</code> 完成认证</span>
                        </li>
                        <li class="flex flex-col sm:flex-row sm:items-start">
                            <div class="flex items-start mb-1 sm:mb-0 sm:mr-2">
                                <i class="fa fa-circle text-yellow-600 mr-2 mt-1 text-xs flex-shrink-0"></i>
                            </div>
                            <span class="text-sm sm:text-base">如需在云服务器或其他远程环境部署，请先在本地运行服务并完成 OAuth 验证，获得生成的 json 凭证文件（位于 <code class="bg-yellow-100 px-1 py-0.5 rounded text-xs sm:text-sm">./geminicli/creds</code> 目录）后，再在auth面板将该文件上传</span>
                        </li>
                        <li class="flex flex-col sm:flex-row sm:items-start">
                            <div class="flex items-start mb-1 sm:mb-0 sm:mr-2">
                                <i class="fa fa-circle text-yellow-600 mr-2 mt-1 text-xs flex-shrink-0"></i>
                            </div>
                            <span class="text-sm sm:text-base">GitHub 项目地址：<a href="https://github.com/su-kaka/gcli2api" target="_blank" class="text-blue-600 hover:underline">https://github.com/su-kaka/gcli2api</a>，可查看最新更新和问题反馈</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>


        <!-- 捐赠指引 -->
        <div class="bg-primary/10 border border-primary/20 rounded-lg p-6">
            <div class="flex items-start">
                <i class="fa fa-heart text-primary text-2xl mr-3 mt-1"></i>
                <div>
                    <h2 class="text-xl font-bold text-gray-800 mb-3">捐赠指引</h2>
                    <p class="text-gray-600 mb-4">
                        获取到 JSON 凭证文件后，您可以通过以下方式捐赠给星星人民公益站：
                    </p>
                    
                    <!-- 文件上传链接 -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                        <h3 class="font-semibold text-blue-800 mb-3 flex items-center">
                            <i class="fa fa-upload text-blue-600 mr-2"></i>
                            上传凭证文件
                        </h3>
                        <a href="https://ug.link/svip/filemgr/collect-invite/?id=d250ea7dff4a4b25950354187102651f"
                           target="_blank"
                           rel="noopener noreferrer"
                           class="inline-flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors w-full sm:w-auto">
                            <i class="fa fa-external-link mr-2"></i>
                            点击上传凭证文件
                        </a>
                        <p class="text-sm text-blue-600 mt-3">获取JSON凭证文件后，请使用此链接上传</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-gray-800 text-white/70 py-8 px-4 mt-12">
        <div class="max-w-4xl mx-auto text-center">
            <p>星星人民公益站 © 2025 - 人民的AI，为人民服务</p>
            <p class="mt-2 text-sm">遵循马克思主义教导，打破技术垄断，让先进生产力服务于最广大劳动人民</p>
        </div>
    </footer>

    <script>
        // 复制代码功能（支持移动端和iframe环境）
        function copyCode(button) {
            const codeBlock = button.parentElement;
            const preElement = codeBlock.querySelector('pre');
            const text = preElement.textContent;
            
            // 创建临时textarea元素进行复制（移动端优化）
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '0';
            textArea.style.top = '0';
            textArea.style.width = '1px';
            textArea.style.height = '1px';
            textArea.style.opacity = '0';
            textArea.style.pointerEvents = 'none';
            document.body.appendChild(textArea);
            
            // 移动端特殊处理：确保textarea在视口内
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                textArea.style.left = '50%';
                textArea.style.top = '50%';
                textArea.style.transform = 'translate(-50%, -50%)';
                textArea.style.width = '100px';
                textArea.style.height = '40px';
                textArea.style.fontSize = '16px'; // 防止iOS缩放
            }
            
            // 选择文本
            textArea.focus();
            textArea.select();
            
            // 移动端需要额外的选择范围设置
            if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                textArea.setSelectionRange(0, 99999);
            } else {
                textArea.setSelectionRange(0, textArea.value.length);
            }
            
            try {
                // 优先使用现代Clipboard API
                if (navigator.clipboard && window.isSecureContext) {
                    navigator.clipboard.writeText(text).then(() => {
                        showCopySuccess(button);
                    }).catch(err => {
                        console.log('Clipboard API失败，使用传统方法:', err);
                        useFallbackCopy(textArea, button);
                    });
                } else {
                    useFallbackCopy(textArea, button);
                }
            } catch (err) {
                console.error('复制错误:', err);
                useFallbackCopy(textArea, button);
            }
        }
        
        function useFallbackCopy(textArea, button) {
            try {
                // 传统execCommand方法
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopySuccess(button);
                } else {
                    // 移动端备选方案：提示用户手动复制
                    if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                        textArea.style.width = '80%';
                        textArea.style.height = '100px';
                        textArea.style.left = '10%';
                        textArea.style.top = '50%';
                        textArea.style.zIndex = '10000';
                        textArea.style.background = 'white';
                        textArea.style.border = '1px solid #ccc';
                        textArea.style.padding = '10px';
                        textArea.style.fontSize = '14px';
                        
                        setTimeout(() => {
                            alert('请手动选择并复制文本');
                            textArea.focus();
                            textArea.select();
                        }, 100);
                        
                        // 5秒后自动移除
                        setTimeout(() => {
                            if (document.body.contains(textArea)) {
                                document.body.removeChild(textArea);
                            }
                        }, 5000);
                    } else {
                        alert('复制失败，请手动选择文本复制');
                        document.body.removeChild(textArea);
                    }
                }
            } catch (err) {
                console.error('传统复制失败:', err);
                alert('复制失败，请手动选择文本复制');
                document.body.removeChild(textArea);
            }
        }
        
        function showCopySuccess(button) {
            const originalText = button.textContent;
            button.textContent = '已复制!';
            button.style.background = '#10b981';
            button.style.borderColor = '#10b981';
            
            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = 'rgba(255,255,255,0.1)';
                button.style.borderColor = 'rgba(255,255,255,0.2)';
                
                // 清理临时textarea
                const textAreas = document.querySelectorAll('textarea[style*="position: fixed"]');
                textAreas.forEach(ta => {
                    if (document.body.contains(ta)) {
                        document.body.removeChild(ta);
                    }
                });
            }, 2000);
        }

        // 为所有代码块添加复制按钮
        document.addEventListener('DOMContentLoaded', function() {
            const codeBlocks = document.querySelectorAll('.code-block');
            
            codeBlocks.forEach((block) => {
                if (!block.querySelector('.copy-btn')) {
                    const button = document.createElement('button');
                    button.className = 'copy-btn';
                    button.textContent = '复制';
                    button.onclick = function() { copyCode(this); };
                    block.appendChild(button);
                } else {
                    const button = block.querySelector('.copy-btn');
                    button.onclick = function() { copyCode(this); };
                }
            });
            
            // 移除调试代码和测试按钮
            const testButton = document.querySelector('button[style*="position: fixed"][style*="top: 10px"]');
            if (testButton) {
                document.body.removeChild(testButton);
            }
        });
    </script>
</body>
</html>